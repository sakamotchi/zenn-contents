---
title: "Claude Codeスキルで実現する仕様駆動開発"
emoji: "📝"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["AI", "Claude", "仕様駆動開発", "開発手法", "ドキュメント"]
published: true
---

# はじめに

AIコーディングエージェントで開発を進めていると、「AIが勝手に進めてしまう」「仕様がブレる」といった課題に直面することはありませんか？

この記事では、Claude Codeのスキル機能を活用して、AIが暴走せず、仕様に基づいた開発を進める「仕様駆動開発」の実践方法を紹介します。

実際に、SQL Query BuilderというTauriアプリケーションの開発で実践している手法です。

https://github.com/sakamotchi/sql-query-build

# AIコーディングの課題

AIコーディングエージェント（Claude Code、ChatGPT、Geminiなど）を使った開発では、以下のような課題があります：

1. **仕様のブレ**: AIに「この機能を追加して」と依頼すると、勝手に解釈して実装してしまう
2. **ドキュメントの不一致**: コードは更新されるが、ドキュメントが古いまま放置される
3. **設計の一貫性**: セッションをまたぐと、前回の設計方針を忘れてしまう
4. **暴走の防止**: AIが余計な変更を加えてしまう

これらの課題を解決するため、「仕様駆動開発」の手法を確立しました。

# 仕様駆動開発とは

仕様駆動開発は、以下の3つの柱で構成されます：

1. **永続化ドキュメント（Steering Documents）**: AIが守るべきルール
2. **開発作業用ドキュメント（Working Documents）**: 作業ごとの仕様書
3. **Claude Codeスキル**: ドキュメント生成の自動化

## 1. 永続化ドキュメント（Steering Documents）

永続化ドキュメントは、プロジェクトの「信頼できる情報源（Single Source of Truth）」として機能します。AIが暴走しないようにするための「ガードレール」の役割を果たします。

### ドキュメント構成

`docs/steering/` 配下に以下のドキュメントを配置しています：

| ドキュメント | 内容 | AIへの効果 |
|------------|------|-----------|
| `01_product_requirements.md` | プロダクト要求定義書 | AIが勝手に機能を追加するのを防ぐ |
| `02_functional_design.md` | 機能設計書 | UIの一貫性を保つ |
| `03_architecture_specifications.md` | 技術仕様書 | 技術スタックの統一 |
| `04_repository_structure.md` | リポジトリ構造定義書 | ファイル配置の統一 |
| `05_development_guidelines.md` | 開発ガイドライン | コーディング規約の統一 |
| `06_ubiquitous_language.md` | ユビキタス言語定義書 | 用語の統一 |

### 実例：プロダクト要求定義書

```markdown
# プロダクト要求定義書（PRD）

## 1. プロダクト概要
### 1.2 目的
GUIベースでSQLクエリを構築できる直感的なデスクトップアプリケーション。
技術者が複数のデータベース環境を安全に操作できることを目的とする。

### 1.4 主要な価値提案
- **視覚的なクエリ構築**: ドラッグ&ドロップによる直感的な操作
- **環境安全性**: 環境別のウィンドウ分離と色分け表示による誤操作防止
- **リアルタイムプレビュー**: SQL構文をリアルタイムで確認可能
- **マルチDB対応**: PostgreSQL、MySQL、SQLiteの主要DBをサポート
```

このドキュメントがあることで、AIに「ここに機能を追加して」と依頼しても、勝手に余計な機能を追加することがなくなります。

### ドキュメント更新のルール

重要なのは、**コードを変更したら必ずドキュメントも更新する**ことです。`CLAUDE.md`に以下のようなルールを記載しています：

```markdown
#### ドキュメント更新のルール

1. **機能追加時**: 該当する機能詳細仕様を更新し、必要に応じて機能設計書・要求定義書も更新
2. **API追加/変更時**: 技術仕様書のコマンド一覧を更新
3. **型定義変更時**: ユビキタス言語定義書を確認し、必要に応じて更新
4. **ディレクトリ/ファイル追加時**: リポジトリ構造定義書を更新
5. **実装状態の変更時**: 各ドキュメントの「状態」欄を更新
```

## 2. 開発作業用ドキュメント（Working Documents）

開発作業用ドキュメントは、個別の開発作業ごとに作成する**一時的なドキュメント**です。

### ディレクトリ構造

```
docs/working/{YYYYMMDD}_{要件名}/
├── requirements.md      # 要件定義書
├── design.md           # 設計書（テストコードも記載）
├── tasklist.md         # タスクリスト
├── task_{タスクID}.md   # 各タスクの詳細ドキュメント
└── testing.md          # テスト手順書
```

### 実例：クエリ実行基盤の要件定義書

実際のプロジェクトで作成した要件定義書の例です：

```markdown
# 要件定義書: クエリ実行基盤（Rust）

## 概要
フロントエンドから生成されたSQLを実際にデータベースで実行し、
結果を返却する機能をRustバックエンドで実装する。

## 実現したいこと

1. **各データベースでのクエリ実行**
   - PostgreSQL、MySQL、SQLiteの3種類のデータベースでSELECT文を実行可能にする
   - QueryExecutorトレイトを定義

2. **フロントエンドからの呼び出し**
   - Tauriコマンド`execute_query`を提供
   - 実行結果は構造化されたデータとして返却

3. **接続の効率的な管理**
   - 接続プールを使用して接続の再利用を実現
```

### 開発作業完了後の扱い

開発作業が完了したら：

1. 永続化ドキュメントを更新
2. 開発作業ドキュメントは削除または`docs/archive/`に移動
3. 重要な設計判断は永続化ドキュメントに反映

## 3. Claude Codeスキル：ドキュメント自動生成

毎回手動でドキュメントを作成するのは大変です。そこで、Claude Codeのスキル機能を使ってドキュメント生成を自動化しました。

### スキルとは

Claude Codeのスキルは、繰り返し実行する作業を自動化する機能です。`.claude/skills/`配下に`SKILL.md`を配置することで、カスタムスキルを定義できます。

### generate-working-docsスキル

開発作業ドキュメント一式を自動生成するスキルを作成しました。

#### スキルの配置

```
.claude/skills/generate-working-docs/
├── SKILL.md              # メインスキル定義
└── subscripts/           # サブスキル
    ├── generate-requirements/
    ├── generate-design/
    ├── generate-tasklist/
    └── generate-testing/
```

#### スキルの使い方

ユーザーが「開発作業ドキュメント作成して」と依頼すると、スキルが起動します：

```
User: クエリ実行機能の開発ドキュメントを作成して
Claude: 要件名を教えてください（英語のケバブケース推奨）
User: query-execution-rust
Claude:
  ✅ docs/working/20251229_query-execution-rust/ を作成
  ✅ requirements.md を生成
  ✅ design.md を生成
  ✅ tasklist.md を生成
  ✅ testing.md を生成
```

#### スキルの仕組み

`SKILL.md`の中身（抜粋）：

```markdown
---
name: generate-working-docs
description: 開発作業ドキュメントを自動生成します
---

## 実行手順

### 1. 作業タイプの判定
ユーザーの要求から作業タイプを判定します：
- パフォーマンス改善 → **パフォーマンス改善**
- それ以外 → **新規機能開発**

### 2. 要件名の確認
要件名を英語のケバブケースで確認

### 3. ディレクトリ作成
mkdir -p docs/working/{YYYYMMDD}_{要件名}

### 4. サブスキルの順次実行
1. `generate-requirements` - 要件定義書生成
2. `generate-design` - 設計書生成
3. `generate-tasklist` - タスクリスト生成
4. `generate-testing` - テスト手順書生成
```

各サブスキルは、永続化ドキュメント（`docs/steering/`）を参照しながら、整合性のとれたドキュメントを生成します。

# 仕様駆動開発のメリット

この手法を導入して、以下のメリットを実感しています：

## 1. AIの暴走防止

永続化ドキュメントがあることで、AIが勝手に機能を追加したり、アーキテクチャを変更したりすることがなくなりました。

**Before（ドキュメントなし）**:
```
User: データベース接続機能を追加して
Claude: わかりました！接続プール、リトライ機能、フェイルオーバー、
        負荷分散、監視機能も追加しておきますね！
```

**After（ドキュメントあり）**:
```
User: データベース接続機能を追加して
Claude: プロダクト要求定義書を確認しました。
        PostgreSQL、MySQL、SQLiteの3つに対応し、
        基本的な接続機能を実装します。
```

## 2. セッションをまたいだ一貫性

永続化ドキュメントを`CLAUDE.md`で参照するように指示することで、セッションをまたいでも設計方針が一貫します。

## 3. ドキュメント更新の強制

開発作業用ドキュメントを作成することで、「何を実装するか」「なぜ実装するか」が明確になります。また、完了後に永続化ドキュメントを更新するフローが確立されます。

## 4. レビューの効率化

コードレビュー前に、設計書とタスクリストを確認することで、実装方針の妥当性を早期に確認できます。

## 5. 新規メンバーのオンボーディング

永続化ドキュメントがあることで、新規メンバー（人間でもAIでも）が迅速にプロジェクトを理解できます。

# 実践例：クエリ実行機能の開発

実際の開発フローを紹介します。

## Step 1: スキルでドキュメント生成

```
User: クエリ実行機能の開発ドキュメントを作成して
Claude: [generate-working-docsスキルが起動]
```

`docs/working/20251229_query-execution-rust/`配下に4つのドキュメントが生成されます。

## Step 2: requirements.mdの確認

生成された要件定義書を確認し、必要に応じて修正します。AIは永続化ドキュメントを参照しているため、基本的に修正は最小限です。

## Step 3: 実装開始

```
User: tasklist.mdのタスク1を実装して
Claude: [tasklist.mdとdesign.mdを参照しながら実装]
```

AIは設計書に従って実装するため、想定外の実装になることがありません。

## Step 4: テスト

```
User: testing.mdの手順でテストして
Claude: [testing.mdの手順を実行]
```

## Step 5: 永続化ドキュメントの更新

実装が完了したら、永続化ドキュメント（技術仕様書など）を更新します。

```
User: 技術仕様書にexecute_queryコマンドを追加して
Claude: [docs/steering/03_architecture_specifications.mdを更新]
```

# 導入方法

この手法を自分のプロジェクトに導入する手順です。

## 1. CLAUDE.mdの作成

プロジェクトルートに`CLAUDE.md`を作成し、開発ガイドラインを記載します。

```markdown
# CLAUDE.md

## ドキュメント

### 永続化ドキュメント（常に整合性を保つ必要あり）

以下のドキュメントはプロジェクトの信頼できる情報源として管理されています。
**コードを変更した際は、関連するドキュメントも必ず更新してください。**

| ドキュメント | 内容 | 更新タイミング |
|------------|------|--------------|
| `docs/steering/01_product_requirements.md` | プロダクト要求定義書 | 要件・機能の追加/変更時 |
...

### 開発作業ドキュメント（一時的なドキュメント）

開発作業は要件ごとに管理し、以下のディレクトリ構造で管理します。

```
docs/working/{YYYYMMDD}_{要件名}/
├── requirements.md
├── design.md
├── tasklist.md
└── testing.md
```
```

## 2. 永続化ドキュメントの作成

`docs/steering/`配下に、最低限以下のドキュメントを作成します：

- プロダクト要求定義書
- 技術仕様書
- 開発ガイドライン

最初はシンプルで構いません。開発を進めながら充実させていきます。

## 3. Claude Codeスキルの作成（オプション）

ドキュメント生成を自動化したい場合は、`.claude/skills/generate-working-docs/`配下にスキルを定義します。

スキル定義の詳細は、以下のリポジトリを参考にしてください：

https://github.com/sakamotchi/sql-query-build/tree/main/.claude/skills/generate-working-docs

## 4. 運用開始

ドキュメントが整ったら、開発を開始します。

```
User: 新機能XXXの開発ドキュメントを作成して
Claude: [スキルが起動してドキュメント生成]
User: requirements.mdを確認して、tasklist.mdのタスク1を実装して
Claude: [実装]
```

# Tips

## ドキュメントは最初から完璧にしない

永続化ドキュメントは、最初からすべて作る必要はありません。開発を進めながら、必要に応じて追加・更新していきます。

## AIにドキュメント更新を依頼する

コードを変更したら、AIに「ドキュメントを更新して」と依頼します。`CLAUDE.md`にルールを書いておけば、AIが適切に更新してくれます。

## スキルは段階的に作成

スキルも最初から完璧にする必要はありません。まずは手動でドキュメントを作成し、パターンが見えてきたらスキル化します。

## ドキュメントのバージョン管理

永続化ドキュメントはGitで管理し、変更履歴を残します。これにより、「なぜこの設計にしたのか」を後から追えます。

# まとめ

Claude Codeスキルを活用した仕様駆動開発により、AIコーディングの課題を解決できました：

1. **永続化ドキュメント**でAIの暴走を防止
2. **開発作業用ドキュメント**で仕様を明確化
3. **Claude Codeスキル**でドキュメント生成を自動化

この手法により、AIと協力しながら、仕様に基づいた一貫性のある開発が可能になります。

実際のドキュメントやスキル定義は、以下のリポジトリで公開しています：

https://github.com/sakamotchi/sql-query-build

ぜひ参考にして、自分のプロジェクトに導入してみてください！
